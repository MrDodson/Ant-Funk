<?xml version="1.0"?>
<!-- ======================================================================
     ANT Macrodef Build Script

     - Strips trace/logging code

     Author: Newtriks <simon@newtriks.com>
     Date :29th December 2009

     This script is based on code written by:
     
     Pedr Browne <pedr.browne@gmail.com>
     
	====================================================================== -->
<project>
	    
	<!-- = = = = = = = = = = = = = = = = =
	     macrodef: strip.logging
	     = = = = = = = = = = = = = = = = = -->
	<macrodef name="strip.logging">
	        
		<attribute name="source" />
	    <attribute name="temporary" />   
	        
		<sequential>
				
			<mkdir dir="@{temporary}"/>
			
			<copy todir="@{temporary}">
				<fileset dir="@{source}"/>
			</copy>
					
			<!-- Strip trace statements -->
			<replaceregexp match="trace\(.*?\);"
						   replace=""
						   flags="gs">
				
				<fileset dir="@{temporary}"
						 includes="**/*.as"/>
				
				<fileset dir="@{temporary}"
						 includes="**/*.mxml"/>
			
			</replaceregexp>
					
			<!-- Strip Logging - Access to LOG constants -->
			<replaceregexp	match="LOG[.].*?\);"
							replace=""
							flags="gs">
						
				<fileset dir="@{temporary}"
						 includes="**/*.as"/>
				
				<fileset dir="@{temporary}"
						 includes="**/*.mxml"/>
			
			</replaceregexp>		
					
			<delete dir="@{temporary}" 
					failOnError="false"
					includeEmptyDirs="true" />
				
		    <echo>Succesfully stripped all logging code</echo>
	        
		</sequential>
	
	</macrodef>
	
</project>